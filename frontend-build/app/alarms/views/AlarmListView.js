// Part of <https://miracle.systems/p/walkner-maxos> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/user","app/i18n","app/core/views/ListView","app/core/views/ActionFormView","../Alarm"],function(e,t,a,i,n,o){"use strict";return i.extend({className:"is-clickable is-colored",remoteTopics:{"alarms.**":function(e,t){"alarms.deleted"===t?this.onModelDeleted(e):-1===t.indexOf("tagChanged")&&this.refreshCollection()}},events:e.extend({"click .action-alarm-ack":function(e){n.showDialog({actionKey:"ack",model:this.getModelFromEvent(e),formActionSeverity:"success"}),e.preventDefault()},"click .action-alarm-run":function(e){n.showDialog({actionKey:"run",model:this.getModelFromEvent(e)}),e.preventDefault()},"click .action-alarm-stop":function(e){n.showDialog({actionKey:"stop",model:this.getModelFromEvent(e),formActionSeverity:"warning"}),e.preventDefault()},"click .action-delete":function(e){n.showDeleteDialog({model:this.getModelFromEvent(e)}),e.preventDefault()}},i.prototype.events),serializeColumns:function(){var e=[{id:"name",label:this.options.nameLabel||a("alarms","PROPERTY:name")}];return!0!==this.options.hideStateColumn&&e.push({id:"stateText",label:a("alarms","PROPERTY:state"),className:"is-min"}),e.push({id:"lastStateChangeTimeText",label:this.options.lastStateChangeTimeLabel||a("alarms","PROPERTY:lastStateChangeTime"),className:"is-min"}),e},serializeActions:function(){var e=!0!==this.options.hideManageActions&&t.isAllowedTo("ALARMS:MANAGE"),n=t.isAllowedTo("ALARMS:ACK"),l=this.collection;return function(t){var s=l.get(t._id),r=[];return t.stopConditionMode===o.StopConditionMode.MANUAL&&n&&r.push({id:"alarm-ack",icon:"thumbs-up",label:a("alarms","LIST:ACTION:ack"),href:s.genClientUrl("ack")}),e&&(t.state===o.State.STOPPED?r.push({id:"alarm-run",icon:"play",label:a("alarms","LIST:ACTION:run"),href:s.genClientUrl("run")}):r.push({id:"alarm-stop",icon:"pause",label:a("alarms","LIST:ACTION:stop"),href:s.genClientUrl("stop")})),r.push(i.actions.viewDetails(s)),e&&r.push(i.actions.edit(s),i.actions.delete(s)),r}}})});