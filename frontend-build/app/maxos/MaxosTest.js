// Part of <https://miracle.systems/p/walkner-maxos> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../i18n","../time","../core/Model"],function(e,s,t,r){"use strict";var a={idle:"info",running:"warning",failure:"danger",success:"success"};return r.extend({urlRoot:"/maxos/tests",clientUrlRoot:"#maxos/tests",topicPrefix:"maxos",privilegePrefix:"MAXOS",nlsDomain:"maxos",getLabel:function(){var e=this.get("serialNumber");if(!e){var s=this.get("order");return s.factoryCode+"."+s._id+".????"}return e},serialize:function(){var r=this.toJSON();return r.className=a[r.status],r.status=s("maxos","status:"+r.status),r.startedAt=t.format(r.startedAt,"L, LTS"),r.finishedAt&&(r.finishedAt=t.format(r.finishedAt,"L, LTS"),r.elapsedTime=t.toString(this.getElapsedTime()/1e3)),r.reason&&(r.reason=s("maxos","message:"+r.reason,e.last(r.messages))),r.order&&(r.orderNo=r.order._id),r.itemNumber||(r.itemNumber=""),r},serializeDetails:function(){var e=this.serialize(),s=this.constructor.serializeMessage;return e.messages=e.messages.map(function(e){return s(e,"default")}),e},getElapsedTime:function(){return Date.parse(this.get("finishedAt"))-Date.parse(this.get("startedAt"))},getStatusClassName:function(){return a[this.attributes.status]}},{serializeMessage:function(r,a){var i=e.clone(r);switch(r.key){case"FAILURE":i.reason=s.has("maxos","message:"+i.reason)?s("maxos","message:"+i.reason,i):i.reason||"?",i.error=i.error||""}return{date:r.date?t.format(r.date,"YYYY-MM-DD, HH:mm:ss.SSS"):"",severity:r.severity||a||"danger",text:s("maxos","message:"+r.key,i)}}})});