// Part of <https://miracle.systems/p/walkner-maxos> licensed under <CC BY-NC-SA 4.0>

define(["app/core/View","../MaxosTest","../templates/message"],function(e,s,t){"use strict";return e.extend({template:t,events:{click:function(){var e=this.model.tags.getValue("program.message");e&&"NO_ORDER"===e.key?this.trigger("orderSelectRequested"):"idle"!==this.model.tags.getValue("program.state")&&this.model.tags.setValue("program.cancelled",!0)}},localTopics:{"socket.disconnected":"render"},initialize:function(){this.listenTo(this.model.tags,"reset",this.render),this.listenTo(this.model.tags,"change:value",this.onTagValueChange)},serialize:function(){return{idPrefix:this.idPrefix,message:this.serializeMessage()}},serializeMessage:function(){return this.socket.isConnected()?s.serializeMessage(this.model.tags.getValue("program.message")||{key:"UNKNOWN"},this.model.test.getStatusClassName()):s.serializeMessage({key:"DISCONNECTED"})},onTagValueChange:function(e){switch(e.id){case"program.message":return this.render()}}})});