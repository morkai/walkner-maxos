// Part of <https://miracle.systems/p/walkner-maxos> licensed under <CC BY-NC-SA 4.0>

define(["underscore","jquery","app/i18n","app/time","app/user","app/viewport","app/core/Model","app/core/View","./LabelPrinterView","../templates/info"],function(e,t,a,r,i,s,n,o,l,u){"use strict";return o.extend({template:u,events:{"click #-changeOrder":function(){this.model.auth.changeOrder()&&this.trigger("orderSelectRequested")},"click #-printLabels":function(){var e=new l({model:this.model});s.showDialog(e,a("maxos","labelPrinter:title"))}},initialize:function(){this.listenTo(this.model.tags,"reset",this.render),this.listenTo(this.model.tags,"change:value",this.onTagValueChange)},serialize:function(){var e=this.model.tags.getValue("program.state");return{idPrefix:this.idPrefix,canChangeOrder:this.model.auth.changeOrder(),canPrintLabels:this.model.auth.printLabels(),state:e,info:this.serializeInfo()}},serializeInfo:function(){var e=this.model.tags,t=e.getValue("program.order"),r=e.getValue("program.quantityDone")||0;return{orderNo:t?t._id:a("maxos","info:selectOrder"),materialNumber:t&&t.materialNumber||"-",productName:t&&t.productName||"-",quantity:t?r+"/"+(t.quantityInOrder||"-"):"-/-",lastSerialNumber:e.getValue("program.lastSerialNumber")||"-"}},onTagValueChange:function(e){switch(e.id){case"program.order":case"program.quantityDone":case"program.lastSerialNumber":return this.render();case"program.state":return this.updateState()}},updateState:function(){this.$id("changeOrder").toggleClass("disabled",!this.model.auth.changeOrder()),this.el.dataset.state=this.model.tags.getValue("program.state")}})});